---
layout: post
title:  "The first mass-produced book to deviate from a rectilinear format"
author: weslley
categories: [ .Net, tutorial ]
image: assets/images/17.jpg
---
### 10:35 08/08/2018 : weslley luiz 
Hello readers, im recording in this gist steps maded by myself for the building of pjsip stack 
Im compiling the stack available on [PjSip]http://pjsip.org/ 

Used to this: Win 10, Vs community 17, VC++2015

##1. Flags to build:
in order to produce a win32 dll to use with .net dll, lets build pjsip stack with the flags bellow:
  
  ```cpp
 //flags used to produce cpp dll
 #define PJ_DLL 1
 #define PJ_EXPORTING 1
 #define PJSUA_DLL_EXPORTS 1
 #define PJ_EXPORT_SPECIFIER  __declspec(dllexport)
 #define PJ_IMPORT_SPECIFIER  __declspec(dllimport)
 // Flags bellow are recomended on pjsip.org
 #define PJ_CONFIG_MINIMAL_SIZE 1
 //i'm not using video options on this tutorial =]
 #define PJMEDIA_HAS_VIDEO	0
 // Uncomment to get maximum performance
 #define PJ_CONFIG_MAXIMUM_SPEED 1
 //required flag to build process
 #include <pj\config_site_sample.h>
  ```
put the flags in a file called config_site.h in pjlib project on pjproject sln
  
In order to produce a Release Dynamic code, we set up the compiler on visual studio to release-dynamic 
  [Pic01]
Building all projects, (except the UWP related project), its okay 1 ERROR ONLY, related to sip cli of demonstration of the sip   stack provided by pjsip.org 
  
the error is above the linkage of .lib's we've compiled and we gonna use now to produce the cpp wrapper.
  
Lets use swig now. 
  
The swig produces the C# code in order to produce another one DLL. Also, produces 2 important files to cpp dll, one source and   one header to cpp win32 dll project.
  
For that lets create one more project in pjproject sln.
  
That project is result of swig cpp files (2 only) and all lib files produced on compilation step
and in that project we follow some settings, to produce a dll without errors on c# sip client when the final desktop client     consumes the cpp api. 
  
lets remind, we build without video, in the options project, lets set the libs we compiled:
  
  **libpjproject-i386-Win32-vc14-Release-Dynamic.lib
    pjlib-i386-Win32-vc14-Release-Dynamic.lib
    pjlib-util-i386-Win32-vc14-Release-Dynamic.lib
    pjnath-i386-Win32-vc14-Release-Dynamic.lib
    pjmedia-i386-Win32-vc14-Release-Dynamic.lib
    pjmedia-codec-i386-Win32-vc14-Release-Dynamic.lib
    libwebrtc-i386-Win32-vc14-Release-Dynamic.lib
    libyuv-i386-Win32-vc14-Release-Dynamic.lib
    libspeex-i386-Win32-vc14-Release-Dynamic.lib
    libilbccodec-i386-Win32-vc14-Release-Dynamic.lib
    libresample-i386-Win32-vc14-Release-Dynamic.lib
    libgsmcodec-i386-Win32-vc14-Release-Dynamic.lib
    libg7221codec-i386-Win32-vc14-Release-Dynamic.lib 
    libbaseclasses-i386-Win32-vc14-Release-Dynamic.lib    
    libsrtp-i386-Win32-vc14-Release-Dynamic.lib 
    libmilenage-i386-Win32-vc14-Release-Dynamic.lib **
    
and the most important, the **ws2_32.lib**, a win socket 32 lib (im producing a 86_64 dll)

That are the builded libs and MUST be referenced in additional libraries, on the cpp project properties you have created.
Continuing, we are the set up the directories where all the libs are founded.

In ** ***Aditional linker Directories*** ** options we put the following directories:
**\Users\wesll\source\pjproject-2.7.2\pjproject-2.7.2\lib
  \Users\wesll\source\pjproject-2.7.2\pjproject-2.7.2\pjlib\lib
  \Users\wesll\source\pjproject-2.7.2\pjproject-2.7.2\pjlib-util\lib
  \Users\wesll\source\pjproject-2.7.2\pjproject-2.7.2\pjmedia\lib
  \Users\wesll\source\pjproject-2.7.2\pjproject-2.7.2\pjnath\lib
  \Users\wesll\source\pjproject-2.7.2\pjproject-2.7.2\pjsip\lib
  \Users\wesll\source\pjproject-2.7.2\pjproject-2.7.2\third_party\lib**
  
Still on the Linker Options, we search (in all options) for the option that enable the use of addictional linked libraries for use the cpp wrapped code generated by swig 

Enabling this bool flag, we tell to vsc++ compiler that we use the fucking compiled libs =].

Now, still on properties project, we set up header options. Remember to save every progress on setting up properties of cpp dll project. Let's set the C\C++ Options:

we created a empty project. it implies we not desire a pre-compiled header, because we used a header wrapped by the swig. Besides that, we need a win32 dll with works with a c# dll with the pj c# classes generated by swig. But for now let's focus on the cpp project.

We need the set up the following flag: **additional include directories**. That directorie is used to tell the compiler where is the .h files used by .lib files generated on compiler 

The following directories i used:
**\Users\wesll\source\pjproject-2.7.2\pjproject-2.7.2\pjlib\include \n
\Users\wesll\source\pjproject-2.7.2\pjproject-2.7.2\pjlib-util\include \n
\Users\wesll\source\pjproject-2.7.2\pjproject-2.7.2\pjmedia\include \n
\Users\wesll\source\pjproject-2.7.2\pjproject-2.7.2\pjnath\include \n
\Users\wesll\source\pjproject-2.7.2\pjproject-2.7.2\pjsip\include \n
\Users\wesll\source\pjproject-2.7.2\pjproject-2.7.2\third_party\include**

LETS BUILD AGAIN MOTHERFUCKER. Only the pjsua2 project (i created a cpp project called pjsua2 in order to produce a file called pjsua2.dll )
That build, produces the fucking first dll, the dll used by another dll.

Lets create one more project, a C# netstandart class, and put all the classes generated by swig. 
Remember the set output option to **release (Any Cpu)** and Build again. That's is the Second Dll.

And also generate errors, we need to change swig generated file because the file generated is not ok.

the fucking file is: **pjsua_snd_dev_id.cs** . 3 changes made we happy and will compile (expected 3 line's with errors)

the changes: 
```csharp
//------------------------------------------------------------------------------
// <auto-generated />
//
// This file was automatically generated by SWIG (http://www.swig.org).
// Version 3.0.12
//
// Do not make changes to this file unless you know what you are doing--modify
// the SWIG interface file instead.
//------------------------------------------------------------------------------


public enum pjsua_snd_dev_id {
  PJSUA_SND_DEFAULT_CAPTURE_DEV = pjmedia_aud_dev_id.PJMEDIA_AUD_DEFAULT_CAPTURE_DEV,
  PJSUA_SND_DEFAULT_PLAYBACK_DEV = pjmedia_aud_dev_id.PJMEDIA_AUD_DEFAULT_PLAYBACK_DEV,
  PJSUA_SND_NO_DEV = pjmedia_aud_dev_id.PJMEDIA_AUD_INVALID_DEV,
  PJSUA_SND_NULL_DEV = -99
}


```
It will necessary change another one file. (last one, i swear ;] )
```csharp
//------------------------------------------------------------------------------
// <auto-generated />
//
// This file was automatically generated by SWIG (http://www.swig.org).
// Version 3.0.12
//
// Do not make changes to this file unless you know what you are doing--modify
// the SWIG interface file instead.
//------------------------------------------------------------------------------


public class pjmedia_tone_digit_map_digits : global::System.IDisposable {
  private global::System.Runtime.InteropServices.HandleRef swigCPtr;
  protected bool swigCMemOwn;

  internal pjmedia_tone_digit_map_digits(global::System.IntPtr cPtr, bool cMemoryOwn) {
    swigCMemOwn = cMemoryOwn;
    swigCPtr = new global::System.Runtime.InteropServices.HandleRef(this, cPtr);
  }

  internal static global::System.Runtime.InteropServices.HandleRef getCPtr(pjmedia_tone_digit_map_digits obj) {
    return (obj == null) ? new global::System.Runtime.InteropServices.HandleRef(null, global::System.IntPtr.Zero) : obj.swigCPtr;
  }

  ~pjmedia_tone_digit_map_digits() {
    Dispose();
  }

  public virtual void Dispose() {
    lock(this) {
      if (swigCPtr.Handle != global::System.IntPtr.Zero) {
        if (swigCMemOwn) {
          swigCMemOwn = false;
          pjsua2PINVOKE.delete_pjmedia_tone_digit_map(swigCPtr);
          //pjsua2PINVOKE.delete_pjmedia_tone_digit_map_digits(swigCPtr);
        }
        swigCPtr = new global::System.Runtime.InteropServices.HandleRef(null, global::System.IntPtr.Zero);
      }
      global::System.GC.SuppressFinalize(this);
    }
  }

  public char digit {
    set {
      pjsua2PINVOKE.pjmedia_tone_digit_digit_set(swigCPtr, value);
    } 
    get {
      char ret = pjsua2PINVOKE.pjmedia_tone_digit_digit_get(swigCPtr);
      return ret;
    } 
  }

  public short freq1 {
    set {
      pjsua2PINVOKE.pjmedia_tone_desc_freq1_set(swigCPtr, value);
    } 
    get {
      short ret = pjsua2PINVOKE.pjmedia_tone_desc_freq1_get(swigCPtr);
      return ret;
    } 
  }

  public short freq2 {
    set {
      pjsua2PINVOKE.pjmedia_tone_desc_freq2_set(swigCPtr, value);
    } 
    get {
      short ret = pjsua2PINVOKE.pjmedia_tone_desc_freq2_get(swigCPtr);
      return ret;
    } 
  }

  public pjmedia_tone_digit_map_digits() : this(pjsua2PINVOKE.new_ToneDigitMapDigit(), true) {
  }

}
```
Now the second dll will compile ok :D

Now it's time to create the .net cli, using the 2 dll's produced. 1 cpp dll with all the sip stack, and 1 .net dll that consumes the api compiled on cpp dll, works like magic, but better :D

  
  
    
    
      

